(()=>{(function(){"use strict";var P=1e4,B=8e3,U=.2,Z=2,T=.1,G={sm:240,md:320,lg:400},V=100,_=40,N=60,M=.15,e={zoom:1,panX:0,panY:0,dragTarget:null,dragOffset:null,project:null,container:null,canvasEl:null,sizerEl:null,wrapperEl:null,svgEl:null,screenEls:{},defaultPositions:{},positions:{},showNotes:!0,hiddenEpics:{},arrowOverrides:{},handleEls:[],draggingHandle:null};function L(){return"fb-"+(e.project?e.project.name:"default")}function D(){try{localStorage.setItem(L()+"-pos",JSON.stringify(e.positions))}catch{}}function ne(){try{var t=localStorage.getItem(L()+"-pos");return t?JSON.parse(t):null}catch{return null}}function R(){try{localStorage.setItem(L()+"-zoom",JSON.stringify({zoom:e.zoom,panX:e.panX,panY:e.panY}))}catch{}}function ae(){try{var t=localStorage.getItem(L()+"-zoom");return t?JSON.parse(t):null}catch{return null}}function oe(){try{localStorage.setItem(L()+"-arrows",JSON.stringify(e.arrowOverrides))}catch{}}function ie(){try{var t=localStorage.getItem(L()+"-arrows");return t?JSON.parse(t):null}catch{return null}}function W(t,r,n){var s={},l={};t.forEach(function(f){s[f.id]=[]}),r.forEach(function(f){s[f.from]&&s[f.from].push(f.to),l[f.to]=!0});var i=t.filter(function(f){return!l[f.id]}).map(function(f){return f.id});i.length===0&&t.length>0&&(i=[t[0].id]);var a={},o={},d=[];for(i.forEach(function(f){d.push(f),a[f]=0,o[f]=!0});d.length>0;){var c=d.shift();(s[c]||[]).forEach(function(f){o[f]||(o[f]=!0,a[f]=(a[c]||0)+1,d.push(f))})}t.forEach(function(f){a[f.id]===void 0&&(a[f.id]=0)});var h={};t.forEach(function(f){var y=a[f.id];h[y]||(h[y]=[]),h[y].push(f)});var p={},v=Object.keys(h).map(Number).sort(function(f,y){return f-y}),m=0,u=0,g=0;v.forEach(function(f){var y=h[f],x=0;y.forEach(function(S){var O=G[S.size||"md"]||G.md;O>x&&(x=O)});var w=0;y.forEach(function(S){p[S.id]={x:m,y:w};var O=n&&n[S.id]?n[S.id]:200;w+=O+_}),w-_>g&&(g=w-_),m+=x+V}),u=m-V;var b=Math.max(0,Math.round((P-u)/2)),E=Math.max(0,Math.round((B-g)/2));return t.forEach(function(f){p[f.id]&&(p[f.id].x+=b,p[f.id].y+=E)}),p}function se(t){if(!e.project||!e.project.epics)return null;for(var r=0;r<e.project.epics.length;r++)if(e.project.epics[r].id===t)return e.project.epics[r];return null}function z(t){if(!e.project||!e.project.screens)return null;for(var r=0;r<e.project.screens.length;r++)if(e.project.screens[r].id===t)return e.project.screens[r];return null}function le(){var t=document.createElement("div");t.className="fb-header";var r=document.createElement("div");r.className="fb-toolbar-group";var n=document.createElement("span");n.className="fb-project-title",n.textContent=e.project.name||"FlowBoard",r.appendChild(n);var s=document.createElement("div");s.className="fb-header-separator",r.appendChild(s);var l=document.createElement("div");l.className="fb-legend",(e.project.epics||[]).forEach(function(g){var b=document.createElement("label");b.className="fb-legend-item";var E=document.createElement("input");E.type="checkbox",E.checked=!e.hiddenEpics[g.id],E.className="fb-legend-checkbox",E.dataset.epicId=g.id,E.addEventListener("change",function(){ce(g.id)}),b.appendChild(E);var f=document.createElement("span");f.className="fb-legend-dot",f.style.background=g.color,b.appendChild(f),b.appendChild(document.createTextNode(g.label)),l.appendChild(b)}),r.appendChild(l),t.appendChild(r);var i=document.createElement("div");i.className="fb-toolbar-group";var a=document.createElement("label");a.className="fb-toggle-label";var o=document.createElement("input");o.type="checkbox",o.checked=e.showNotes,o.addEventListener("change",function(){e.showNotes=o.checked,de()}),a.appendChild(o),a.appendChild(document.createTextNode("Notes")),i.appendChild(a);var d=document.createElement("div");d.className="fb-header-separator",i.appendChild(d);var c=document.createElement("button");c.className="fb-toolbar-btn",c.textContent="\u2212",c.title="Zoom out",c.addEventListener("click",function(){Q(e.zoom-T)}),i.appendChild(c);var h=document.createElement("span");h.className="fb-zoom-label",h.id="fb-zoom-label",h.textContent=Math.round(e.zoom*100)+"%",i.appendChild(h);var p=document.createElement("button");p.className="fb-toolbar-btn",p.textContent="+",p.title="Zoom in",p.addEventListener("click",function(){Q(e.zoom+T)}),i.appendChild(p);var v=document.createElement("div");v.className="fb-header-separator",i.appendChild(v);var m=document.createElement("button");m.className="fb-action-btn",m.textContent="Reset",m.title="Reset positions",m.addEventListener("click",be),i.appendChild(m);var u=document.createElement("button");return u.className="fb-action-btn",u.textContent="Export PNG",u.title="Export as PNG",u.addEventListener("click",Ee),i.appendChild(u),t.appendChild(i),t}function de(){for(var t=e.container.querySelectorAll(".fb-screen-footer"),r=0;r<t.length;r++)e.showNotes?t[r].classList.remove("fb-hidden"):t[r].classList.add("fb-hidden")}function ce(t){e.hiddenEpics[t]?delete e.hiddenEpics[t]:e.hiddenEpics[t]=!0;for(var r=e.container.querySelectorAll(".fb-legend-checkbox"),n=0;n<r.length;n++){var s=r[n],l=s.closest(".fb-legend-item");s.dataset.epicId===t&&(s.checked=!e.hiddenEpics[t],e.hiddenEpics[t]?l.classList.add("fb-dimmed"):l.classList.remove("fb-dimmed"))}e.project.screens.forEach(function(i){var a=e.screenEls[i.id];a&&(e.hiddenEpics[i.epic]?a.classList.add("fb-hidden"):a.classList.remove("fb-hidden"))}),I()}function fe(t){var r=se(t.epic),n=r?r.color:"#666",s=t.size||"md",l=document.createElement("div");l.className="fb-screen fb-size-"+s,l.dataset.screenId=t.id;var i=e.positions[t.id]||{x:100,y:100};l.style.left=i.x+"px",l.style.top=i.y+"px";var a=document.createElement("div");a.className="fb-screen-header",a.style.background=n,a.innerHTML="<span>"+pe(t.title)+"</span>",l.appendChild(a);var o=document.createElement("div");if(o.className="fb-screen-body",o.innerHTML=t.content||"",l.appendChild(o),t.notes){var d=document.createElement("div");d.className="fb-screen-footer"+(e.showNotes?"":" fb-hidden"),d.textContent=t.notes,l.appendChild(d)}return e.hiddenEpics[t.epic]&&l.classList.add("fb-hidden"),e.screenEls[t.id]=l,l}function pe(t){var r=document.createElement("div");return r.textContent=t,r.innerHTML}function Q(t){var r=Math.max(U,Math.min(Z,Math.round(t*100)/100));if(e.wrapperEl){var n=e.wrapperEl.getBoundingClientRect(),s=n.width/2,l=n.height/2,i=(s-e.panX)/e.zoom,a=(l-e.panY)/e.zoom;e.panX=s-i*r,e.panY=l-a*r}e.zoom=r,X();var o=document.getElementById("fb-zoom-label");o&&(o.textContent=Math.round(e.zoom*100)+"%"),R()}function X(){e.sizerEl&&(e.sizerEl.style.transform="translate("+e.panX+"px,"+e.panY+"px) scale("+e.zoom+")")}function $(){if(!(!e.wrapperEl||!e.project)){var t=e.project.screens||[],r=1/0,n=1/0,s=0,l=0,i=!1;if(t.forEach(function(f){if(!e.hiddenEpics[f.epic]){var y=e.screenEls[f.id],x=e.positions[f.id];!y||!x||(i=!0,r=Math.min(r,x.x),n=Math.min(n,x.y),s=Math.max(s,x.x+y.offsetWidth),l=Math.max(l,x.y+y.offsetHeight))}}),!!i){var a=e.wrapperEl.getBoundingClientRect(),o=a.width,d=a.height,c=s-r,h=l-n,p=60,v=(o-p*2)/c,m=(d-p*2)/h,u=Math.min(v,m,1);u=Math.max(U,Math.min(Z,Math.round(u*100)/100));var g=(o-c*u)/2-r*u,b=(d-h*u)/2-n*u;e.zoom=u,e.panX=g,e.panY=b,X();var E=document.getElementById("fb-zoom-label");E&&(E.textContent=Math.round(e.zoom*100)+"%"),R()}}}function ve(){var t=e.wrapperEl;t.addEventListener("wheel",function(r){if(r.ctrlKey||r.metaKey){r.preventDefault();var n=t.getBoundingClientRect(),s=r.clientX-n.left,l=r.clientY-n.top,i=(s-e.panX)/e.zoom,a=(l-e.panY)/e.zoom,o=r.deltaY>0?-T:T,d=Math.max(U,Math.min(Z,Math.round((e.zoom+o)*100)/100));e.panX=s-i*d,e.panY=l-a*d,e.zoom=d,X();var c=document.getElementById("fb-zoom-label");c&&(c.textContent=Math.round(e.zoom*100)+"%"),R()}else r.preventDefault(),e.panX-=r.deltaX,e.panY-=r.deltaY,X(),R()},{passive:!1})}function ue(){e.canvasEl.addEventListener("mousedown",function(t){var r=t.target.closest(".fb-screen");if(r){t.stopPropagation(),t.preventDefault(),e.dragTarget=r;var n=r.getBoundingClientRect();e.dragOffset={x:t.clientX-n.left,y:t.clientY-n.top},r.classList.add("fb-dragging"),e.wrapperEl.classList.add("fb-dragging-screen")}}),document.addEventListener("mousemove",function(t){if(e.dragTarget){var r=e.wrapperEl.getBoundingClientRect(),n=(t.clientX-r.left-e.panX)/e.zoom-e.dragOffset.x/e.zoom,s=(t.clientY-r.top-e.panY)/e.zoom-e.dragOffset.y/e.zoom;n=Math.max(0,Math.min(P-50,n)),s=Math.max(0,Math.min(B-50,s)),e.dragTarget.style.left=n+"px",e.dragTarget.style.top=s+"px";var l=e.dragTarget.dataset.screenId;e.positions[l]={x:n,y:s},I(!!e.draggingHandle)}}),document.addEventListener("mouseup",function(){e.dragTarget&&(e.dragTarget.classList.remove("fb-dragging"),e.dragTarget=null,e.dragOffset=null,e.wrapperEl.classList.remove("fb-dragging-screen"),D())})}function me(){e.canvasEl.addEventListener("mousedown",function(t){var r=t.target.closest(".fb-arrow-handle");if(r){t.stopPropagation(),t.preventDefault();var n=r.dataset.arrowKey,s=r.dataset.arrowEnd,l=r.dataset.screenId;if(!e.arrowOverrides[n]){var i=Y();if(i[n])e.arrowOverrides[n]={fromSide:i[n].from,toSide:i[n].to};else{var a=n.split("->"),o=e.screenEls[a[0]],d=e.screenEls[a[1]];if(o&&d){var c=J(o,d);e.arrowOverrides[n]={fromSide:c.from,toSide:c.to}}else e.arrowOverrides[n]={fromSide:"right",toSide:"left"}}}e.draggingHandle={key:n,end:s,el:r,screenId:l},e.wrapperEl.classList.add("fb-dragging-handle")}}),document.addEventListener("mousemove",function(t){if(e.draggingHandle){for(var r=e.wrapperEl.getBoundingClientRect(),n=(t.clientX-r.left-e.panX)/e.zoom,s=(t.clientY-r.top-e.panY)/e.zoom,l=e.draggingHandle.screenId,i=ee(l),a=1/0,o=i[0],d=0;d<i.length;d++){var c=i[d].x-n,h=i[d].y-s,p=c*c+h*h;p<a&&(a=p,o=i[d])}e.draggingHandle.el.style.left=o.x-8+"px",e.draggingHandle.el.style.top=o.y-8+"px";var v=e.draggingHandle.end==="from"?"fromSide":"toSide";e.arrowOverrides[e.draggingHandle.key][v]=o.name,I(!0)}}),document.addEventListener("mouseup",function(){e.draggingHandle&&(oe(),te(),e.draggingHandle=null,e.wrapperEl.classList.remove("fb-dragging-handle"))})}function J(t,r){var n=t.dataset.screenId,s=r.dataset.screenId,l=e.positions[n],i=e.positions[s],a=t.offsetWidth,o=t.offsetHeight,d=r.offsetWidth,c=r.offsetHeight,h=l.x+a/2,p=l.y+o/2,v=i.x+d/2,m=i.y+c/2,u=v-h,g=m-p;return Math.abs(u)>=Math.abs(g)?u>0?{from:"right",to:"left"}:{from:"left",to:"right"}:g>0?{from:"bottom",to:"top"}:{from:"top",to:"bottom"}}function k(t,r){var n=e.screenEls[t];if(!n)return{x:0,y:0};var s=e.positions[t],l=n.offsetWidth,i=n.offsetHeight,a=r?r.split("-"):[],o,d;if(a.length===1)o=a[0],d=.5;else if(a[0]==="left"||a[0]==="right"){o=a[0];var c={top:1/6,upper:2/6,middle:.5,lower:4/6,bottom:5/6};d=c[a[1]]!==void 0?c[a[1]]:.5}else{o=a[0];var h={left:.25,right:.75};d=h[a[1]]!==void 0?h[a[1]]:.5}switch(o){case"left":return{x:s.x,y:s.y+i*d};case"right":return{x:s.x+l,y:s.y+i*d};case"top":return{x:s.x+l*d,y:s.y};case"bottom":return{x:s.x+l*d,y:s.y+i};default:return{x:s.x+l/2,y:s.y+i/2}}}function F(t){return t?t.split("-")[0]:"right"}function q(t,r,n,s){var l=F(n),i=F(s),a=r.x-t.x,o=r.y-t.y,d={x:t.x,y:t.y},c={x:r.x,y:r.y};switch(l){case"right":d.x+=N,d.y+=o*M;break;case"left":d.x-=N,d.y+=o*M;break;case"bottom":d.y+=N,d.x+=a*M;break;case"top":d.y-=N,d.x+=a*M;break}switch(i){case"right":c.x+=N,c.y-=o*M;break;case"left":c.x-=N,c.y-=o*M;break;case"bottom":c.y+=N,c.x-=a*M;break;case"top":c.y-=N,c.x-=a*M;break}return{cp1:d,cp2:c}}function K(t,r){var n=t.from+"->"+t.to,s=e.arrowOverrides[n];if(s)return{from:s.fromSide,to:s.toSide};if(r&&r[n])return r[n];var l=e.screenEls[t.from],i=e.screenEls[t.to];return l&&i?J(l,i):{from:"right",to:"left"}}function ee(t){for(var r=["left-top","left-upper","left-middle","left-lower","left-bottom","right-top","right-upper","right-middle","right-lower","right-bottom","top-left","top","top-right","bottom-left","bottom","bottom-right"],n=[],s=0;s<r.length;s++){var l=k(t,r[s]);n.push({name:r[s],x:l.x,y:l.y})}return n}function Y(){var t=e.project?e.project.arrows||[]:[],r={};t.forEach(function(s,l){var i=z(s.from),a=z(s.to);if(!(i&&e.hiddenEpics[i.epic])&&!(a&&e.hiddenEpics[a.epic])){var o=[s.from,s.to].sort(),d=o[0]+"|"+o[1];r[d]||(r[d]=[]),r[d].push(l)}});var n={};return Object.keys(r).forEach(function(s){var l=r[s];l.length<=1||l.forEach(function(i,a){var o=t[i],d=o.from+"->"+o.to;if(!e.arrowOverrides[d]){var c=e.screenEls[o.from],h=e.screenEls[o.to];if(!(!c||!h)){var p=J(c,h),v=p.from==="right"||p.from==="left",m;l.length===2?m=v?["-upper","-lower"]:["-left","-right"]:l.length===3?m=v?["-upper","-middle","-lower"]:["-left","","-right"]:l.length===4?m=v?["-top","-upper","-lower","-bottom"]:["-left","","-right"]:m=v?["-top","-upper","-middle","-lower","-bottom"]:["-left","","-right"];var u=m[Math.min(a,m.length-1)];n[d]={from:p.from+u,to:p.to+u}}}})}),n}function I(t){if(!(!e.svgEl||!e.project)){var r=e.project.arrows||[],n="http://www.w3.org/2000/svg",s=Y();e.svgEl.innerHTML="";var l=document.createElementNS(n,"defs"),i=document.createElementNS(n,"marker");i.setAttribute("id","fb-arrowhead"),i.setAttribute("markerUnits","userSpaceOnUse"),i.setAttribute("markerWidth","14"),i.setAttribute("markerHeight","14"),i.setAttribute("refX","14"),i.setAttribute("refY","7"),i.setAttribute("orient","auto");var a=document.createElementNS(n,"polygon");a.setAttribute("points","0 0, 14 7, 0 14"),a.setAttribute("fill","#888"),i.appendChild(a),l.appendChild(i),e.svgEl.appendChild(l),r.forEach(function(o){var d=e.screenEls[o.from],c=e.screenEls[o.to];if(!(!d||!c)){var h=z(o.from),p=z(o.to);if(!(h&&e.hiddenEpics[h.epic])&&!(p&&e.hiddenEpics[p.epic])){var v=o.from+"->"+o.to,m=K(o,s),u=k(o.from,m.from),g=k(o.to,m.to),b=q(u,g,m.from,m.to),E=b.cp1,f=b.cp2,y="M"+u.x+","+u.y+" C"+E.x+","+E.y+" "+f.x+","+f.y+" "+g.x+","+g.y,x=document.createElementNS(n,"g");x.setAttribute("class","fb-arrow-group");var w=document.createElementNS(n,"path");w.setAttribute("d",y),w.setAttribute("class","fb-arrow-path"+(o.dashed?" fb-dashed":"")),w.setAttribute("fill","none"),w.setAttribute("stroke","#888"),w.setAttribute("stroke-width","2"),o.dashed&&w.setAttribute("stroke-dasharray","6 4"),w.setAttribute("marker-end","url(#fb-arrowhead)"),x.appendChild(w);var S=document.createElementNS(n,"path");if(S.setAttribute("d",y),S.setAttribute("class","fb-arrow-hit"),S.setAttribute("fill","none"),S.setAttribute("stroke","transparent"),S.setAttribute("stroke-width","16"),S.setAttribute("pointer-events","stroke"),x.appendChild(S),e.svgEl.appendChild(x),o.label){var O=(u.x+g.x+E.x+f.x)/4,re=(u.y+g.y+E.y+f.y)/4,A=document.createElementNS(n,"text");A.setAttribute("x",O),A.setAttribute("y",re),A.setAttribute("class","fb-arrow-label"),A.setAttribute("fill","#555"),A.setAttribute("font-size","11"),A.setAttribute("font-family",'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'),A.setAttribute("text-anchor","middle"),A.setAttribute("dominant-baseline","central"),A.textContent=o.label,e.svgEl.appendChild(A);var j;try{j=A.getBBox()}catch{j={x:O-20,y:re-8,width:40,height:16}}var C=document.createElementNS(n,"rect");C.setAttribute("x",j.x-4),C.setAttribute("y",j.y-2),C.setAttribute("width",j.width+8),C.setAttribute("height",j.height+4),C.setAttribute("class","fb-arrow-label-bg"),C.setAttribute("fill","#f0f2f5"),C.setAttribute("rx","3"),C.setAttribute("ry","3"),e.svgEl.insertBefore(C,A)}}}}),t||te()}}function te(){if(e.handleEls.forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)}),e.handleEls=[],!!e.project){var t=e.project.arrows||[],r=Y();t.forEach(function(n){var s=e.screenEls[n.from],l=e.screenEls[n.to];if(!(!s||!l)){var i=z(n.from),a=z(n.to);if(!(i&&e.hiddenEpics[i.epic])&&!(a&&e.hiddenEpics[a.epic])){var o=n.from+"->"+n.to,d=K(n,r),c=k(n.from,d.from),h=k(n.to,d.to);[{pt:c,end:"from",screenId:n.from},{pt:h,end:"to",screenId:n.to}].forEach(function(p){var v=document.createElement("div");v.className="fb-arrow-handle",v.style.left=p.pt.x-8+"px",v.style.top=p.pt.y-8+"px",v.dataset.arrowKey=o,v.dataset.arrowEnd=p.end,v.dataset.screenId=p.screenId,e.canvasEl.appendChild(v),e.handleEls.push(v)})}}})}}var H=null;function he(){return H||(H=new Promise(function(t,r){if(window.html2canvas){t(window.html2canvas);return}var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js",n.onload=function(){t(window.html2canvas)},n.onerror=function(){H=null,r(new Error("Failed to load html2canvas"))},document.head.appendChild(n)}),H)}function ge(){var t=1/0,r=1/0,n=0,s=0,l=e.project.arrows||[],i=Y();return e.project.screens.forEach(function(a){if(!e.hiddenEpics[a.epic]){var o=e.screenEls[a.id],d=e.positions[a.id];!o||!d||(t=Math.min(t,d.x),r=Math.min(r,d.y),n=Math.max(n,d.x+o.offsetWidth),s=Math.max(s,d.y+o.offsetHeight))}}),l.forEach(function(a){var o=z(a.from),d=z(a.to);if(!(o&&e.hiddenEpics[o.epic])&&!(d&&e.hiddenEpics[d.epic])){var c=e.screenEls[a.from],h=e.screenEls[a.to];if(!(!c||!h)){var p=K(a,i),v=k(a.from,p.from),m=k(a.to,p.to),u=q(v,m,p.from,p.to),g=u.cp1,b=u.cp2;[v,m,g,b].forEach(function(E){t=Math.min(t,E.x),r=Math.min(r,E.y),n=Math.max(n,E.x),s=Math.max(s,E.y)})}}}),{minX:t,minY:r,maxX:n,maxY:s}}function Ee(){if(!(!e.canvasEl||!e.project)){var t=ge();if(t.minX!==1/0){var r=40,n=Math.max(0,t.minX-r),s=Math.max(0,t.minY-r),l=t.maxX-t.minX+r*2,i=t.maxY-t.minY+r*2,a=document.createElement("div");a.className="fb-container",a.style.cssText="position:fixed;left:-99999px;top:0;width:"+l+"px;height:"+i+"px;overflow:visible;background:transparent;",e.project.screens.forEach(function(v){if(!e.hiddenEpics[v.epic]){var m=e.screenEls[v.id],u=e.positions[v.id];if(!(!m||!u)){var g=m.cloneNode(!0);g.style.left=u.x-n+"px",g.style.top=u.y-s+"px",a.appendChild(g)}}});var o=e.svgEl.cloneNode(!0);o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("viewBox",n+" "+s+" "+l+" "+i),o.setAttribute("width",l),o.setAttribute("height",i);var d=new XMLSerializer().serializeToString(o),c=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(c),p=new Image;p.onload=function(){URL.revokeObjectURL(h);var v=document.createElement("canvas");v.width=l*2,v.height=i*2,v.style.cssText="position:absolute;top:0;left:0;width:"+l+"px;height:"+i+"px;pointer-events:none;",v.getContext("2d").drawImage(p,0,0,l*2,i*2),a.appendChild(v),document.body.appendChild(a),he().then(function(m){return m(a,{width:l,height:i,scale:2,backgroundColor:"#f0f2f5",useCORS:!0})}).then(function(m){document.body.removeChild(a);var u=document.createElement("a");u.download=(e.project.name||"flowboard")+".png",u.href=m.toDataURL("image/png"),u.click()}).catch(function(m){a.parentNode&&document.body.removeChild(a),console.error("Export failed:",m)})},p.onerror=function(){URL.revokeObjectURL(h),console.error("Arrow rasterization failed")},p.src=h}}}function be(){var t={};e.project.screens.forEach(function(a){var o=e.screenEls[a.id];o&&(t[a.id]=o.offsetHeight)});var r=e.project.screens||[],n=e.project.arrows||[];e.defaultPositions=W(r,n,t),e.positions=JSON.parse(JSON.stringify(e.defaultPositions)),r.forEach(function(a){var o=e.screenEls[a.id],d=e.positions[a.id];o&&d&&(o.style.left=d.x+"px",o.style.top=d.y+"px")}),e.hiddenEpics={};for(var s=e.container.querySelectorAll(".fb-legend-checkbox"),l=0;l<s.length;l++){s[l].checked=!0;var i=s[l].closest(".fb-legend-item");i&&i.classList.remove("fb-dimmed")}r.forEach(function(a){var o=e.screenEls[a.id];o&&o.classList.remove("fb-hidden")}),e.arrowOverrides={};try{localStorage.removeItem(L()+"-arrows")}catch{}D(),I(),$()}function ye(t){if(!t||!t.project){console.error("FlowBoard.init: config.project is required");return}e.project=t.project,e.showNotes=!0,e.hiddenEpics={},e.arrowOverrides={};var r;if(typeof t.container=="string"?r=document.querySelector(t.container):t.container instanceof HTMLElement&&(r=t.container),!r){console.error("FlowBoard.init: container not found");return}var n=document.createElement("div");n.className="fb-container",r.innerHTML="",r.appendChild(n),e.container=n,n.appendChild(le());var s=document.createElement("div");s.className="fb-canvas-wrapper";var l=document.createElement("div");l.className="fb-canvas-sizer";var i=document.createElement("div");i.className="fb-canvas",i.style.width=P+"px",i.style.height=B+"px";var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class","fb-arrows-layer"),a.setAttribute("width",P),a.setAttribute("height",B),i.appendChild(a),l.appendChild(i),s.appendChild(l),n.appendChild(s),e.wrapperEl=s,e.sizerEl=l,e.canvasEl=i,e.svgEl=a,e.screenEls={};var o=e.project.screens||[],d=e.project.arrows||[];e.defaultPositions=W(o,d),e.positions=JSON.parse(JSON.stringify(e.defaultPositions));var c=ne(),h=!1;c&&(h=!0,o.forEach(function(g){c[g.id]&&(e.positions[g.id]=c[g.id])}));var p=ae(),v=!1;if(p&&(v=!0,e.zoom=p.zoom||1,e.panX=p.panX||0,e.panY=p.panY||0),v){var m=document.getElementById("fb-zoom-label");m&&(m.textContent=Math.round(e.zoom*100)+"%")}var u=ie();u&&(e.arrowOverrides=u),o.forEach(function(g){var b=fe(g);i.appendChild(b)}),X(),ve(),ue(),me(),requestAnimationFrame(function(){var g={};o.forEach(function(b){var E=e.screenEls[b.id];E&&(g[b.id]=E.offsetHeight)}),e.defaultPositions=W(o,d,g),h||(e.positions=JSON.parse(JSON.stringify(e.defaultPositions)),o.forEach(function(b){var E=e.screenEls[b.id],f=e.positions[b.id];E&&f&&(E.style.left=f.x+"px",E.style.top=f.y+"px")})),v||$(),I()})}window.FlowBoard={init:ye,_internal:{state:e,autoLayout:W,getAnchor:k,getPrimarySide:F,computeControlPoints:q,getAllAnchorPoints:ee,getBestSides:J,buildSpreadMap:Y,resolveArrowSides:K}}})();})();
